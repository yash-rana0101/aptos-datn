"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[547],{2547:function(e,r,t){t.d(r,{EE:function(){return y},gl:function(){return l.gl},HF:function(){return l.HF},Pt:function(){return w},Aj:function(){return f},iB:function(){return l.iB},Cc:function(){return m},HY:function(){return l.HY},d_:function(){return _},vO:function(){return l.vO},Gn:function(){return n.Gn},Gr:function(){return n.Gr}});var n=t(4516),l=t(4903),a=t(5118),o=t(7693);t(7776);var i=t(108),s=t(2752);let u=async e=>{try{let r=await s.lV.view({payload:{function:"".concat(i.VB.ORDER,"::get_order"),functionArguments:[e]}});if(!r||0===r.length)return null;let[t,n,l,a,o,u,c,d,f,y,p,v]=r;return{orderAddress:e,orderId:parseInt(t),productAddress:n,buyerAddress:l,sellerAddress:a,quantity:parseInt(o),totalPrice:parseInt(u),shippingAddress:c,status:d,isPaid:f,createdAt:parseInt(y),updatedAt:parseInt(p),notes:v}}catch(e){return console.error("Error fetching order:",e),null}},c=async e=>{try{return(await s.lV.view({payload:{function:"".concat(i.VB.ORDER,"::get_buyer_orders"),functionArguments:[e]}}))[0]}catch(e){return console.error("Error fetching buyer orders:",e),[]}},d={all:["orders"],lists:()=>[...d.all,"list"],detail:e=>[...d.all,"detail",e],buyerOrders:e=>[...d.all,"buyer",e],sellerOrders:e=>[...d.all,"seller",e],status:e=>[...d.all,"status",e]},f=function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return(0,a.a)({queryKey:d.detail(e),queryFn:()=>u(e),enabled:r&&!!e,staleTime:6e4})},y=e=>{var r;let{account:t}=(0,o.Os)(),n=e||(null==t?void 0:null===(r=t.address)||void 0===r?void 0:r.toString());return(0,a.a)({queryKey:d.buyerOrders(n||""),queryFn:()=>c(n),enabled:!!n,staleTime:12e4})},p=async e=>{try{let r=await s.lV.view({payload:{function:"".concat(i.VB.ESCROW,"::get_escrow_order"),functionArguments:[e]}});if(!r||0===r.length)return null;let[t,n,l,a,o,u,c,d,f,y,p,v,g,w,m]=r;return{escrowOrderAddress:e,orderId:parseInt(t),productAddress:n,buyerAddress:l,sellerAddress:a,quantity:parseInt(o),totalPrice:parseInt(u),lockedFunds:parseInt(c),shippingAddress:d,status:f,deliveryCode:y,receivingCode:p,transactionHash:v,createdAt:parseInt(g),deliveredAt:parseInt(w),confirmedAt:parseInt(m)}}catch(e){return console.error("Error fetching escrow order:",e),null}},v=async e=>{try{return(await s.lV.view({payload:{function:"".concat(i.VB.ESCROW,"::get_seller_escrow_orders"),functionArguments:[e]}}))[0]}catch(e){return console.error("Error fetching seller escrow orders:",e),[]}},g={all:["escrow"],lists:()=>[...g.all,"list"],detail:e=>[...g.all,"detail",e],buyerEscrows:e=>[...g.all,"buyer",e],sellerEscrows:e=>[...g.all,"seller",e],status:e=>[...g.all,"status",e],deliveryCode:e=>[...g.all,"deliveryCode",e],receivingCode:e=>[...g.all,"receivingCode",e]},w=function(e){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return(0,a.a)({queryKey:g.detail(e),queryFn:()=>p(e),enabled:r&&!!e,staleTime:6e4})},m=e=>{var r;let{account:t}=(0,o.Os)(),n=e||(null==t?void 0:null===(r=t.address)||void 0===r?void 0:r.toString());return(0,a.a)({queryKey:g.sellerEscrows(n||""),queryFn:()=>v(n),enabled:!!n,staleTime:12e4})};var h=t(9914);let _=e=>{var r;let{account:t}=(0,o.Os)(),n=e||(null==t?void 0:null===(r=t.address)||void 0===r?void 0:r.toString());return(0,a.a)({queryKey:["seller-products",n],queryFn:async()=>{if(!n)return[];let e=await (0,h.mC)(n);return(await Promise.all(e.map(e=>(0,h.wv)(e)))).filter(e=>null!==e&&!e.isDeleted)},enabled:!!n,staleTime:3e4})}},4516:function(e,r,t){t.d(r,{sS:function(){return w},Gn:function(){return m},Gr:function(){return g}});var n=t(5118),l=t(3191),a=t(5524),o=t(7693),i=t(7776),s=t(108),u=t(2752);let c=e=>{let r=(e.startsWith("0x")?e.slice(2):e).padStart(64,"0");return"0x".concat(r)},d=e=>{let{name:r,country:t,role:n,email:l,address:a,bio:o}=e;return{data:{function:"".concat(s.VB.USER_PROFILE,"::register_profile"),functionArguments:[r,t,n,l,a,o]},options:s.OI}},f=e=>{let{profileAddress:r,name:t,country:n,email:l,address:a,bio:o}=e;return{data:{function:"".concat(s.VB.USER_PROFILE,"::update_profile"),functionArguments:[c(r),t||"",n||"",l||"",a||"",o||""]},options:s.OI}},y=async e=>{try{let r=await u.lV.view({payload:{function:"".concat(s.VB.USER_PROFILE,"::get_profile"),functionArguments:[c(e)]}});if(!r||0===r.length)return null;let t=r[0];return{name:t.name,walletAddress:t.wallet_address,country:t.country,role:t.role,email:t.email,physicalAddress:t.physical_address,bio:t.bio,createdAt:"string"==typeof t.created_at?parseInt(t.created_at):t.created_at,updatedAt:"string"==typeof t.updated_at?parseInt(t.updated_at):t.updated_at,isActive:t.is_active}}catch(e){return console.error("Error fetching user profile:",e),null}},p=e=>{let r=e.startsWith("0x")?e.slice(2):e;return"0x".concat(r.padStart(64,"0"))},v={all:["profile"],detail:e=>[...v.all,"detail",e],isBuyer:e=>[...v.all,"isBuyer",e],isSeller:e=>[...v.all,"isSeller",e],isActive:e=>[...v.all,"isActive",e],details:e=>[...v.all,"details",e]},g=function(e){var r;let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{account:l}=(0,o.Os)(),a=e||(null==l?void 0:null===(r=l.address)||void 0===r?void 0:r.toString()),i=a?p(a):void 0;return(0,n.a)({queryKey:v.detail(i||""),queryFn:()=>y(i),enabled:t&&!!i,staleTime:3e5})},w=()=>{let e=(0,l.NL)(),{account:r,signAndSubmitTransaction:t}=(0,o.Os)();return(0,a.D)({mutationFn:async e=>{if(!r)throw Error("Wallet not connected");try{let r=d(e);return await t(r)}catch(e){var n,l;if((null===(n=e.message)||void 0===n?void 0:n.includes("keyless_account"))||(null===(l=e.message)||void 0===l?void 0:l.includes("Groth16VerificationKey")))throw Error("Local network configuration issue. Please ensure your Petra wallet is connected to the correct network (Devnet or Testnet) for development.");throw e}},onSuccess:()=>{if(null==r?void 0:r.address){let t=p(r.address.toString());e.invalidateQueries({queryKey:v.detail(t)}),e.invalidateQueries({queryKey:v.all})}i.Am.success("Profile registered successfully!")},onError:e=>{i.Am.error(e.message||"Failed to register profile"),console.error("Register profile error:",e)}})},m=()=>{let e=(0,l.NL)(),{account:r,signAndSubmitTransaction:t}=(0,o.Os)();return(0,a.D)({mutationFn:async e=>{if(!r)throw Error("Wallet not connected");let n=f(e);return await t(n)},onSuccess:(r,t)=>{let n=p(t.profileAddress);e.invalidateQueries({queryKey:v.detail(n)}),i.Am.success("Profile updated successfully!")},onError:e=>{i.Am.error(e.message||"Failed to update profile"),console.error("Update profile error:",e)}})}}}]);