<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Test - DATN</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        .card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        pre {
            background: #0f172a;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            border: 1px solid #334155;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background: #10b981; }
        .status-error { background: #ef4444; }
    </style>
</head>
<body>
    <h1>üîç Network Configuration Test</h1>
    
    <div class="card">
        <h2>Current Configuration</h2>
        <div id="config"></div>
    </div>

    <div class="card">
        <h2>Test Aptos Connection</h2>
        <button onclick="testConnection()">Test Testnet Connection</button>
        <button onclick="testMainnet()">Test Mainnet Connection</button>
        <div id="test-result"></div>
    </div>

    <div class="card">
        <h2>Petra Wallet Status</h2>
        <button onclick="checkWallet()">Check Wallet Network</button>
        <div id="wallet-status"></div>
    </div>

    <div class="card">
        <h2>Environment Variables</h2>
        <pre id="env-vars">Loading...</pre>
    </div>

    <script>
        // Display config
        document.getElementById('config').innerHTML = `
            <p><strong>Expected Network:</strong> <span class="success">TESTNET</span></p>
            <p><strong>Module Address:</strong> 0xd12ba7bbf9ba31f64e262f446a3fcc9f20a51209dfe5cc67a1ed278a45a85a8c</p>
            <p><strong>Browser:</strong> ${navigator.userAgent.split(' ').slice(-2).join(' ')}</p>
        `;

        // Test testnet connection
        async function testConnection() {
            const result = document.getElementById('test-result');
            result.innerHTML = '<p class="warning">Testing testnet connection...</p>';
            
            try {
                const response = await fetch('https://api.testnet.aptoslabs.com/v1/accounts/0xd12ba7bbf9ba31f64e262f446a3fcc9f20a51209dfe5cc67a1ed278a45a85a8c/modules');
                const data = await response.json();
                
                if (data && Array.isArray(data) && data.length > 0) {
                    result.innerHTML = `
                        <p class="success">‚úÖ TESTNET connection works!</p>
                        <p>Found ${data.length} modules deployed</p>
                        <p>Modules: ${data.map(m => m.abi.name).join(', ')}</p>
                    `;
                } else {
                    result.innerHTML = '<p class="error">‚ùå No modules found on testnet</p>';
                }
            } catch (error) {
                result.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }

        // Test mainnet (should fail)
        async function testMainnet() {
            const result = document.getElementById('test-result');
            result.innerHTML = '<p class="warning">Testing mainnet connection...</p>';
            
            try {
                const response = await fetch('https://api.mainnet.aptoslabs.com/v1/accounts/0xd12ba7bbf9ba31f64e262f446a3fcc9f20a51209dfe5cc67a1ed278a45a85a8c/modules');
                const data = await response.json();
                
                if (data.error_code === 'account_not_found' || data.error_code === 'module_not_found') {
                    result.innerHTML = `
                        <p class="success">‚úÖ CORRECT: Module NOT on mainnet (as expected)</p>
                        <p class="success">Your contracts are on TESTNET only</p>
                    `;
                } else if (Array.isArray(data) && data.length > 0) {
                    result.innerHTML = `
                        <p class="error">‚ö†Ô∏è WARNING: Found modules on mainnet?</p>
                        <p>This is unexpected - your contracts should only be on testnet</p>
                    `;
                }
            } catch (error) {
                result.innerHTML = `<p class="warning">Mainnet check: ${error.message}</p>`;
            }
        }

        // Check Petra wallet
        async function checkWallet() {
            const status = document.getElementById('wallet-status');
            
            if (typeof window.petra === 'undefined' && typeof window.aptos === 'undefined') {
                status.innerHTML = '<p class="error">‚ùå Petra wallet not installed</p>';
                return;
            }

            try {
                const petra = window.petra || window.aptos;
                const isConnected = await petra.isConnected();
                const network = await petra.network();
                
                const isTestnet = network.name.toLowerCase().includes('testnet');
                
                status.innerHTML = `
                    <p><span class="status-indicator ${isConnected ? 'status-ok' : 'status-error'}"></span>
                    Connection: ${isConnected ? 'Connected' : 'Not connected'}</p>
                    <p><span class="status-indicator ${isTestnet ? 'status-ok' : 'status-error'}"></span>
                    Network: <strong class="${isTestnet ? 'success' : 'error'}">${network.name}</strong></p>
                    <p>Chain ID: ${network.chainId}</p>
                    ${!isTestnet ? '<p class="error">‚ö†Ô∏è WARNING: Wallet is NOT on testnet! Please switch to testnet in Petra extension.</p>' : ''}
                `;
            } catch (error) {
                status.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            }
        }

        // Show env vars (from Next.js page)
        fetch('/api/debug-env')
            .then(r => r.json())
            .then(data => {
                document.getElementById('env-vars').textContent = JSON.stringify(data, null, 2);
            })
            .catch(() => {
                document.getElementById('env-vars').textContent = 'Could not fetch env vars (API route not available)';
            });

        // Auto-check wallet on load
        setTimeout(() => {
            if (typeof window.petra !== 'undefined' || typeof window.aptos !== 'undefined') {
                checkWallet();
            }
        }, 500);
    </script>
</body>
</html>
